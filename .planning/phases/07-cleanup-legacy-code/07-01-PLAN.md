---
phase: 07-cleanup-legacy-code
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - run/runner.py
  - run/legacy/ML_history_wandb.py
  - run/legacy/ML_history_multi_wandb.py
  - run/legacy/integration_sanity.py
  - run/legacy/tidal_sanity.py
autonomous: true

must_haves:
  truths:
    - "runner.py has no unused imports"
    - "Legacy scripts are removed from repository"
    - "Training and simulation still work correctly"
  artifacts:
    - path: "run/runner.py"
      provides: "Clean import section without loss_fn_batch imports"
      contains: "from src import"
  key_links:
    - from: "run/runner.py"
      to: "src/__init__.py"
      via: "import statement"
      pattern: "from src import"
---

<objective>
Remove unused imports from runner.py and delete legacy training scripts.

Purpose: Clean up dead code now that the two-phase training system is fully integrated. The loss_fn_batch family of functions is no longer called from runner.py, and the legacy scripts in run/legacy/ are replaced by the unified runner.py interface.

Output: Clean runner.py with no unused imports, legacy directory removed from git.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-cleanup-legacy-code/07-RESEARCH.md
@run/runner.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused imports from runner.py</name>
  <files>run/runner.py</files>
  <action>
Edit the import block in run/runner.py (lines 15-29) to remove the unused loss function imports.

Current imports from src:
```python
from src import (
    Config,
    FullyConnectedNN,
    HistoryBuffer,
    ModelAdapter,
    load_model_state,
    load_config_from_checkpoint,
    loss_fn_batch,              # REMOVE
    loss_fn_batch_history,      # REMOVE
    loss_fn_batch_history_batch, # REMOVE
    make_particle,
    run_two_phase_training,
    save_checkpoint,
    stack_particles,
)
```

After edit:
```python
from src import (
    Config,
    FullyConnectedNN,
    HistoryBuffer,
    ModelAdapter,
    load_model_state,
    load_config_from_checkpoint,
    make_particle,
    run_two_phase_training,
    save_checkpoint,
    stack_particles,
)
```

Keep alphabetical order after Config (which is convention here).
  </action>
  <verify>
Run: `python -c "from run.runner import main; print('Import OK')"`
Expected: "Import OK" with no errors
  </verify>
  <done>
runner.py imports only the functions it actually uses. No import errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete legacy training scripts</name>
  <files>
run/legacy/ML_history_wandb.py
run/legacy/ML_history_multi_wandb.py
run/legacy/integration_sanity.py
run/legacy/tidal_sanity.py
  </files>
  <action>
Remove the legacy scripts directory and all its contents using git rm:

```bash
git rm -r run/legacy/
```

These scripts are replaced by:
- ML_history_wandb.py -> `python run/runner.py train` with two-phase system
- ML_history_multi_wandb.py -> `python run/runner.py train` (multi-orbit warns, single orbit used)
- integration_sanity.py -> covered by tests/test_runner_integration.py
- tidal_sanity.py -> tidal field tested elsewhere

Do NOT delete the files outside git (they must be tracked for removal).
  </action>
  <verify>
Run: `ls run/legacy/ 2>&1`
Expected: "ls: cannot access 'run/legacy/': No such file or directory"

Run: `git status --short run/legacy/`
Expected: Files show as deleted (D) or nothing if already staged
  </verify>
  <done>
Legacy directory and all scripts removed from git tracking.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify training and simulation still work</name>
  <files></files>
  <action>
Run quick sanity checks to verify the cleanup didn't break functionality:

1. Import check:
```bash
python -c "from run.runner import main; print('Runner import OK')"
```

2. Quick training test (3 epochs, 3 particles):
```bash
python run/runner.py train --epochs 3 --num-particles 3 --save-name cleanup_test
```

3. Quick simulation test:
```bash
python run/runner.py simulate --num-particles 3 --steps 100
```

4. Run existing test suite:
```bash
pytest tests/test_runner_integration.py -v --tb=short
```

If any test fails, investigate and fix before proceeding.
  </action>
  <verify>
All commands complete without error. Training produces output. Simulation produces JSON with energy/momentum data. Tests pass.
  </verify>
  <done>
Training and simulation work correctly after cleanup. Test suite passes.
  </done>
</task>

</tasks>

<verification>
1. `python -c "from run.runner import main"` succeeds
2. `ls run/legacy/` shows directory does not exist
3. `git status` shows legacy files as deleted
4. `pytest tests/test_runner_integration.py` passes
5. No unused imports in runner.py (can verify with flake8 if available)
</verification>

<success_criteria>
1. runner.py no longer imports loss_fn_batch, loss_fn_batch_history, or loss_fn_batch_history_batch
2. run/legacy/ directory is removed from git
3. Training works: `python run/runner.py train --epochs 3 --num-particles 3`
4. Simulation works: `python run/runner.py simulate --num-particles 3 --steps 100`
5. All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-cleanup-legacy-code/07-01-SUMMARY.md`
</output>
